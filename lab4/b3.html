<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý sinh viên</title>
</head>

<body>
    <h3>QUẢN LÝ SINH VIÊN</h3>
    <div>
        <p>Id: <input id="id">
        <p>Full Name: <input id="name">
        <p>Everage Mark: <input id="mark">
        <p>Gender:
            <input name="gender" type="radio" id="male">Male
            <input name="gender" type="radio" id="female">Female
    </div>
    <hr>
    <button onclick="$api.create()">Create</button>
    <button onclick="$api.update()">Update</button>
    <button onclick="$api.delete()">Delete</button>
    <button onclick="$api.reset()">Reset</button>
    <hr>
    <table border="1" style="width:100%">
        <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Mark</th>
                <th>Gender</th>
                <th></th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        const host = "https://j6lab4-8bd39-default-rtdb.asia-southeast1.firebasedatabase.app";
        const $api = {
            key: null,
            get student() {
                return {
                    id: $("#id").val(),
                    name: $("#name").val(),
                    mark: $("#mark").val(),
                    gender: $("#male").prop("checked")
                };
            },
            set student(e) {
                $("#id").val(e.id);
                $("#name").val(e.name);
                $("#mark").val(e.mark);
                $("#male").prop("checked", e.gender);
                $("#female").prop("checked", !e.gender);
            },
            fillToTable() {
                var url = `${host}/students.json`;
                axios.get(url).then(resp => {
                    $("tbody").empty();
                    Object.keys(resp.data || {}).forEach(key => {
                        var e = resp.data[key];
                        var tr = `<tr>
                            <td>${e.id}</td>
                            <td>${e.name}</td>
                            <td>${e.mark}</td>
                            <td>${e.gender ? 'Male' : 'Female'}</td>
                            <td>
                                <a href="#" onclick=\"$api.edit('${key}')\">Edit</a> |
                                <a href="#" onclick=\"$api.delete('${key}')\">Delete</a>
                            </td>
                        </tr>`;
                        $("tbody").append(tr);
                    });
                }).catch(error => {
                    alert("Lỗi tải danh sách sinh viên!");
                });
            },
            edit(key) {
                this.key = key.trim();
                var url = `${host}/students/${key}.json`;
                axios.get(url).then(resp => {
                    this.student = resp.data;
                }).catch(error => {
                    alert("Lỗi tải sinh viên!");
                });
            },
            create() {
                var url = `${host}/students.json`;
                axios.post(url, this.student).then(resp => {
                    this.fillToTable();
                    this.reset();
                }).catch(error => {
                    alert("Lỗi thêm sinh viên mới!");
                });
            },
            update() {
                var url = `${host}/students/${this.key}.json`;
                axios.put(url, this.student).then(resp => {
                    this.fillToTable();
                }).catch(error => {
                    alert("Lỗi cập nhật sinh viên!");
                });
            },
            delete(key) {
                var url = `${host}/students/${key || this.key}.json`;
                axios.delete(url).then(resp => {
                    this.fillToTable();
                    this.reset();
                }).catch(error => {
                    alert("Lỗi xóa sinh viên!");
                });
            },
            reset() {
                this.key = null;
                this.student = {};
            }
        };
        $api.fillToTable();
    </script>
</body>

</html>